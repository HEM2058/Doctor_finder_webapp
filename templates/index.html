{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static '/style.css' %}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    
    <title>Doctor Finder</title>
    
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg bg-light">
            <div class="container-fluid">
              <a class="navbar-brand" href="#">Doctor Finder</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="{%  url 'index' %}">Map view</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Doctors List</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Find Hospital </a>
                  </li>
                
                </ul>
              </div>
            </div>
          </nav>
    </header>
   
    <div id="map"></div>
    
    <footer>
      <div class="card text-right ">
       
        <div class="card-body">
        <h5 class="card-title" style="display:inline">Are you Doctor?</h5>
                 
          <span><a href="{% url 'login' %}" class="btn btn-primary">Login Now</a></span>
           <span><a href="{% url 'register' %}" class="btn btn-primary">Register Now</a></span>
           <span> <button type="button" class="btn btn-primary btn-danger" data-bs-toggle="popover" data-bs-title="Frequently Asked Question" data-bs-content="What is Doctor Finder?       Ans: Doctor Finder is webapp developed inorder to connect patients to nearest doctors and hospitals">FAQ</button></span>
           <button type="button" class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Nearest Doctors"  onclick="myFunction()">
            <img src="{% static '/Doctor_marker.png' %}" alt="" width="35" height="25" >
        </button>
        <button type="button" class="btn btn-primary" onclick="Navigation()">
            Navigate with Doctor
        </button>
        
           
           <!-- <span><a href="" class="btn btn-primary">Nearest Doctors</a></span> -->
          
           <p class="card-text">By registering, your information will be visible to nearest patients and contacted you.</p>
        </div>
      </div>
    </footer>
</body>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="{% static '/nepal3.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static '/nepal3.js' %}"></script>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
 <script src="{% static '/main.js' %}"></script>
 <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
 <script>
  const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
  const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
 </script>
 
</html>

<script>
    
    var markerGroup = new L.featureGroup()
     {% for n in dl %}
         var lat = {{n.lat}}
         var lng = {{n.lng}}
         var marker = L.marker([lat, lng]).bindPopup(`<h3>Name:{{n.fname}} {{n.lname}}</h3><h4>Highest Degree:{{n.highest_degree}}</h4><p>{{n.services_offers}}</p>`)
         marker.addTo(markerGroup).addTo(map)
     {% endfor %}
  
      
     function myFunction()
     {
     if(!navigator.geolocation)
{
    console.log("your browser does not support geolocation service")
}

else{
   
        navigator.geolocation.getCurrentPosition(getPosition)
    
    }

     var marker,circle;

    function getPosition(position) {
    console.log(position)
    var lat = position.coords.latitude
    var lng = position.coords.longitude
    var accuracy = position.coords.accuracy
      
    if(marker)
    {
       map.removeLayer(marker)
    }
    if(circle){
        map.removeLayer(circle)
    }
    marker = L.marker([lat,lng],7)
    circle = L.circle([lat,lng], {radius:accuracy})
    var featureGroup = L.featureGroup([marker,circle]).addTo(map)
    map.fitBounds(featureGroup.getBounds())
}
     }

     function Navigation() {
        if(!navigator.geolocation)
{
    console.log("your browser does not support geolocation service")
}

else{
   
        navigator.geolocation.getCurrentPosition(getPosition)
    
    }

    function getPosition(position) {
    console.log(position)
    var lat = position.coords.latitude
    var lng = position.coords.longitude
    var accuracy = position.coords.accuracy

       
 //map click event
 {% for n in dl%}
  var lat1 = {{n.lat}}
  var lng1 = {{n.lng}}
  var mark = L.marker([lat1,lng1]).addTo(map).on('click', onClick);
{%endfor%}


//     
     

function onClick(e){
        
        alert(this.getLatLng())
        

     
    

    //  map.on('click',function(e){
    //     console.log(e)
    //     var secondMarker = L.marker([e.latlng.lat,e.latlng.lng]).addTo(map)
        L.Routing.control({
  waypoints: [
   
    L.latLng(lat, lng),
    L.latLng(e.latlng.lat,e.latlng.lng)

  ]
  }).addTo(map);
        
     
 

    }
}
     }


  
  </script>
